<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HireHub ‚Äî Job Seeker Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --blue-1:#004aad;
      --blue-2:#0078d4;
      --bg:#f4f7fb;
      --muted:#6b7280;
      --card:#ffffff;
      --accent:#0b78e6;
      --danger:#e23b3b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background:var(--bg);
      color:#111827;
      min-height:100vh;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* HEADER */
    header{
      background: linear-gradient(90deg,var(--blue-2),var(--blue-1));
      color:#fff;
      padding:14px 28px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 3px 8px rgba(2,6,23,0.08);
    }
    .brand{ font-weight:700; font-size:23px; letter-spacing:0.2px; }
    .header-actions{ display:flex; gap:12px; align-items:center; }
    .username-pill{
      background:rgba(255,255,255,0.12);
      padding:8px 12px;
      border-radius:999px;
      font-weight:700;
    }
    .hdr-btn{
      background:#fff;
      color:var(--blue-1);
      border:none;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:700;
    }
    .hdr-btn.logout{ background:var(--danger); color:#fff; }

    /* MAIN LAYOUT */
    main{ padding:28px; max-width:1200px; margin:0 auto; }

    /* WELCOME CARD (large) */
    .welcome-card{
      background:var(--card);
      border-radius:14px;
      padding:28px;
      box-shadow:0 10px 24px rgba(2,6,23,0.06);
      position:relative;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:18px;
      margin-bottom:22px;
    }
    .welcome-left{
      max-width:72%;
    }
    .welcome-left h1{
      margin:0;
      color:var(--blue-1);
      font-size:28px;
      letter-spacing:0.2px;
    }
    .welcome-left p{ margin:8px 0 0 0; color:var(--muted); }

    /* Applied Jobs button in top-right of card */
    .applied-btn{
      position:absolute;
      right:22px;
      top:22px;
      background:linear-gradient(90deg,var(--blue-2),var(--blue-1));
      color:#fff;
      border:none;
      padding:10px 14px;
      border-radius:8px;
      font-weight:800;
      cursor:pointer;
    }

    /* SEARCH BAR centered under title */
    .section-header{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      margin-top:8px;
    }
    .section-title{ font-size:22px; color:var(--blue-1); margin:18px 0; text-align:center; font-weight:800; }
    .search-row{
      display:flex;
      gap:10px;
      margin: 6px auto 22px auto;
      max-width:760px;
      width:100%;
      justify-content:center;
    }
    .search-row input{
      flex:1; min-width:260px;
      padding:10px 14px;
      border-radius:10px;
      border:1px solid #e6eef9;
      background:#fff;
      font-size:14px;
      box-shadow:0 4px 14px rgba(16,24,40,0.04);
    }
    .search-row button{
      padding:10px 14px;
      border-radius:10px;
      border:none;
      background:linear-gradient(90deg,var(--blue-2),var(--blue-1));
      color:#fff;
      font-weight:800;
      cursor:pointer;
    }

    /* JOB GRID */
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(260px,1fr));
      gap:18px;
      margin-top:10px;
    }
    .job-card{
      background:var(--card);
      border-radius:12px;
      padding:16px;
      box-shadow:0 6px 18px rgba(2,6,23,0.04);
      transition:transform .15s ease, box-shadow .15s ease;
      cursor:pointer;
    }
    .job-card:hover{ transform:translateY(-6px); box-shadow:0 14px 34px rgba(2,6,23,0.08); }
    .job-title{ color:rgb(81, 136, 26); font-weight:800; margin:0 0 8px 0; font-size:16px; }
    .meta{ color:var(--muted); font-size:13px; margin:4px 0; }
    .meta b{ color:#111827; font-weight:700; }

    /* EMPTY */
    .empty{
      text-align:center;
      padding:36px;
      border-radius:12px;
      background:var(--card);
      box-shadow:0 8px 20px rgba(2,6,23,0.04);
      color:var(--muted);
    }

    /* Logout confirmation popup */
    .popup-overlay{
      position:fixed; inset:0; display:none; background:rgba(0,0,0,0.45);
      justify-content:center; align-items:center; z-index:60;
    }
    .popup-box{
      background:white; padding:22px; border-radius:10px; width:320px; text-align:center;
      box-shadow:0 10px 30px rgba(0,0,0,0.2);
    }
    .popup-box button{ margin:8px; padding:8px 12px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
    .btn-yes{ background:var(--danger); color:#fff; }
    .btn-no{ background:#e6eef9; color:var(--blue-1); }

    /* Responsive */
    @media(max-width:900px){
      .welcome-left{ max-width:60%; }
      .applied-btn{ right:14px; top:14px; padding:8px 12px; }
    }
    @media(max-width:600px){
      .welcome-card{ flex-direction:column; align-items:flex-start; padding:18px; }
      .applied-btn{ position:static; align-self:flex-end; margin-top:10px; }
      .search-row{ padding:0 16px; }
      .header-actions{ gap:8px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">HireHub üéØ ‚Äî Job Seeker Dashboard</div>
    <div class="header-actions">
      <div id="username" class="username-pill">User</div>
      <button id="profileBtn" class="hdr-btn">Profile</button>
      <button id="logoutBtn" class="hdr-btn logout">Logout</button>
    </div>
  </header>

  <main>
    <div class="welcome-card">
      <div class="welcome-left">
        <h1>Welcome, <span id="welcomeName">User</span> üëã</h1>
        <p>Explore latest jobs from top recruiters ‚Äî click any job card to view full details and apply.</p>
      </div>

      <button id="appliedJobs" class="applied-btn">My Applied Jobs</button>
    </div>

    <div class="section-header">
      <div style="flex-basis:100%; text-align:center;">
        <div class="section-title">Available Jobs</div>
        <div class="search-row">
          <input id="searchInput" placeholder="Search by title, location, or skill (e.g. Java, Chennai)" />
          <button id="searchBtn">Search</button>
        </div>
      </div>
    </div>

    <div id="jobsGrid" class="grid" aria-live="polite"></div>
    <div id="emptyState" class="empty" style="display:none;">No jobs found ‚Äî try a different keyword.</div>
  </main>

  <!-- Logout popup -->
  <div id="logoutPopup" class="popup-overlay" role="dialog" aria-modal="true">
    <div class="popup-box">
      <p style="font-weight:800; margin:0 0 10px 0;">Logout from HireHub?</p>
      <div style="font-size:13px; color:var(--muted); margin-bottom:12px;">You will be returned to the login page.</div>
      <button id="confirmLogout" class="btn-yes">Yes, Logout</button>
      <button id="cancelLogout" class="btn-no">Cancel</button>
    </div>
  </div>

  <script>
    (function(){
      const API_BASE = "https://hirehub-backend-03b4.onrender.com";
      const jobsGrid = document.getElementById('jobsGrid');
      const emptyState = document.getElementById('emptyState');
      const searchInput = document.getElementById('searchInput');
      const searchBtn = document.getElementById('searchBtn');
      const profileBtn = document.getElementById('profileBtn');
      const appliedBtn = document.getElementById('appliedJobs');
      const usernameNode = document.getElementById('username');
      const welcomeName = document.getElementById('welcomeName');

      // logout popup elems
      const logoutBtn = document.getElementById('logoutBtn');
      const logoutPopup = document.getElementById('logoutPopup');
      const confirmLogout = document.getElementById('confirmLogout');
      const cancelLogout = document.getElementById('cancelLogout');

      // show jobs in grid
      function renderJobs(jobs){
        jobsGrid.innerHTML = '';
        if(!jobs || jobs.length === 0){
          emptyState.style.display = 'block';
          jobsGrid.style.display = 'none';
          return;
        }
        emptyState.style.display = 'none';
        jobsGrid.style.display = 'grid';

        jobs.forEach(job => {
          const card = document.createElement('div');
          card.className = 'job-card';
          // show companyName if recruiter object present; your backend may include recruiter in job JSON
          const company = (job.recruiter && job.recruiter.companyName) ? job.recruiter.companyName : (job.postedBy?.username || "N/A");
          const postedAt = job.postedAt ? (new Date(job.postedAt)).toLocaleDateString() : '';
          card.innerHTML = `
            <h4 class="job-title">${escapeHtml(job.title || 'Untitled')}</h4>
            <p class="meta"><b>Company:</b> ${escapeHtml(company)}</p>
            <p class="meta"><b>Location:</b>üìç  ${escapeHtml(job.location || '‚Äî')}</p>
            <p class="meta"><b>Salary:</b> ${escapeHtml(job.salary ?? '‚Äî')}</p>
          `;
          // when card clicked -> job-details page
          card.addEventListener('click', (ev) => {
            // avoid clicks when buttons exist (none now) ‚Äî safe route
            window.location.href = `jobseeker-jobdetails.html?jobId=${job.id}`;
          });
          jobsGrid.appendChild(card);
        });
      }

      // safe escape
      function escapeHtml(s){ return String(s || '').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }

      // load all jobs (uses session cookies)
      async function loadJobs(){
        try{
          jobsGrid.innerHTML = '';
          emptyState.style.display = 'none';
          // GET all jobs - your endpoint; replace if different
          const res = await fetch(`${API_BASE}/front/jobs`, { credentials: 'include' });
          if(res.status === 401 || res.status === 403){
            // session expired - redirect login
            localStorage.clear();
            window.location.href = 'login.html';
            return;
          }
          if(!res.ok) {
            console.error('Failed to load jobs:', res.status);
            emptyState.style.display = 'block';
            return;
          }
          const jobs = await res.json();
          renderJobs(jobs);
          window.__allJobs = jobs || []; // store global for client-side filtering
        }catch(err){
          console.error('Error loading jobs:', err);
          emptyState.style.display = 'block';
        }
      }

      // client-side search (title/location/skill)
      function doSearch(){
        const q = (searchInput.value || '').trim().toLowerCase();
        if(!q){
          renderJobs(window.__allJobs || []);
          return;
        }
        const filtered = (window.__allJobs || []).filter(j => {
          return (j.title || '').toLowerCase().includes(q)
              || (j.location || '').toLowerCase().includes(q)
              || (j.skillsRequired || '').toLowerCase().includes(q);
        });
        renderJobs(filtered);
      }

      // init on DOMContentLoaded
      document.addEventListener('DOMContentLoaded', () => {
        const uname = localStorage.getItem('username') || 'User';
        usernameNode.textContent = uname;
        welcomeName.textContent = uname;

        // load jobs
        loadJobs();

        // handlers
        searchBtn.addEventListener('click', doSearch);
        searchInput.addEventListener('keydown', (e)=> { if(e.key === 'Enter') doSearch(); });

        profileBtn.addEventListener('click', ()=> {
          window.location.href = 'jobseeker-profile.html';
        });

        appliedBtn.addEventListener('click', ()=> {
          window.location.href = 'jobseeker-appliedjobs.html';
        });

        // logout popup
        logoutBtn.addEventListener('click', ()=> logoutPopup.style.display = 'flex');
        cancelLogout.addEventListener('click', ()=> logoutPopup.style.display = 'none');
        confirmLogout.addEventListener('click', async ()=>{
          try{
            await fetch(`${API_BASE}/auth/logout`, { method: 'POST', credentials: 'include' }).catch(()=>null);
          }catch(e){/*ignore*/ }
          localStorage.clear();
          window.location.href = 'login.html';
        });
      });
    })();
  </script>
</body>
</html>
