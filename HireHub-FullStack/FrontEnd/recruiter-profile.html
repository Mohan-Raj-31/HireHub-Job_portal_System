<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>HireHub — Recruiter Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
:root {
  --blue-1: #004aad;
  --blue-2: #0078d4;
  --bg: #f4f6f9;
  --muted: #6b7280;
  --danger: #e63946;
}
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: var(--bg);
  color: #1f2937;
}
.topbar {
  background: #fff;
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
.back-btn {
  background: rgba(223, 223, 223, 0.8);
  border: none;
  border-radius: 6px;
  padding: 8px 14px;
  color: var(--blue-2);
  font-weight: 600;
  cursor: pointer;
}
.back-btn:hover { background: #e2e8f0; }

.profile-card {
  max-width: 600px;
  margin: 40px auto;
  background: #fff;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 6px 20px rgba(16,24,40,0.08);
}
.profile-header {
  background: linear-gradient(135deg, var(--blue-1), var(--blue-2));
  color: white;
  text-align: center;
  padding: 40px 20px 60px;
  position: relative;
}
.avatar {
  width: 100px; height: 100px;
  border-radius: 50%;
  background: white;
  color: var(--blue-1);
  font-weight: 800;
  font-size: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  left: 50%;
  bottom: -50px;
  transform: translateX(-50%);
  border: 4px solid #fff;
}
.profile-body {
  padding: 70px 24px 30px;
  text-align: center;
}
.profile-body h2 { color: var(--blue-1); margin-bottom: 10px; }
.profile-body p { color: var(--muted); margin: 5px 0; }

.actions { display: flex; justify-content: center; gap: 12px; margin-top: 20px; }
.btn {
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}
.btn-edit { background: var(--blue-2); color: #fff; }
.btn-account { background: #10b981; color: #fff; }
.btn:hover { opacity: 0.9; }

/* Modal */
.modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  align-items: center;
  justify-content: center;
}
.modal.active { display: flex; }
.modal-content {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 450px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.1);
}
.modal-content h3 { margin-top: 0; color: var(--blue-1); }
.modal-content input {
  width: 94%;
  padding: 8px;
  margin-bottom: 10px;
  margin-top: 5px;
  border-radius: 6px;
  border: 2px solid #b6b6b6;
}
.modal-content label {
  font-weight: 600;
}
.modal textarea{
  width: 94%;
  height: 80px;
  padding: 10px;
  margin-bottom: 10px;
  margin-top: 5px;
  border-radius: 8px;
  border: 2px solid #b6b6b6;
  resize: none;
}

.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}
.btn-cancel { background: #ddd; }
</style>
</head>
<body>

<div class="topbar">
  <button class="back-btn" id="backBtn">⬅ Back to Dashboard</button>
  <h2>Recruiter Profile</h2>
</div>

<div class="profile-card" id="profileCard">
  <div class="profile-header">
    <div class="avatar" id="avatar">R</div>
  </div>
  <div class="profile-body">
    <h2 id="companyName">Company Name</h2>
    <p id="website"></p>
    <p id="location"></p>
    <p id="since"></p>
    <p id="description"></p>
    <div class="actions">
      <button class="btn btn-edit" id="editProfileBtn">Edit Profile</button>
      <button class="btn btn-account" id="editAccountBtn">Account Settings</button>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal" id="editProfileModal">
  <div class="modal-content">
    <h3>Edit Company Profile</h3>
    <div>
        <label>Company Name</label>
        <input id="companyNameInput" placeholder="Company Name" />
    </div>
    <div>
        <label>Company Website</label>
        <input id="companyWebsiteInput" placeholder="Company Website" />
    </div>
    <div>
        <label>Location</label>
        <input id="locationInput" placeholder="Location" />
    </div>
    <div>
        <label>Since (year)</label>
        <input id="sinceInput" type="number" placeholder="Since (year)" />
    </div>
    <div>
        <label>Company Description</label>
        <textarea id="companyDescriptionInput" maxlength="255" placeholder="Company Description" required></textarea>
    </div>

    <div class="modal-actions">
      <button class="btn btn-cancel" id="cancelEditProfile">Cancel</button>
      <button class="btn btn-edit" id="saveProfileBtn">Save</button>
    </div>
  </div>
</div>

<!-- Edit Account Modal -->
<div class="modal" id="editAccountModal">
  <div class="modal-content">
    <h3>Update Account Info</h3>
    <input id="usernameInput" placeholder="Username" />
    <input id="emailInput" placeholder="Email" />
    <input id="passwordInput" placeholder="Password" type="password" />
    <div class="modal-actions">
      <button class="btn btn-cancel" id="cancelEditAccount">Cancel</button>
      <button class="btn btn-account" id="saveAccountBtn">Save</button>
    </div>
  </div>
</div>

<script>
const API_BASE = "https://hirehub-backend-03b4.onrender.com";
const userId = localStorage.getItem("userId");

const profileModal = document.getElementById("editProfileModal");
const accountModal = document.getElementById("editAccountModal");

let recruiterProfile = {}; // store recruiter details globally

document.getElementById("backBtn").onclick = () => window.location.href = "recruiter.html";

// Load profile
async function loadProfile() {
  try {
    const resp = await fetch(`${API_BASE}/front/recruiter/${userId}`, { credentials: "include" });
    if (!resp.ok) throw new Error("Failed to fetch profile");
    const data = await resp.json();
    recruiterProfile = data; // store globally

    document.getElementById("companyName").textContent = data.companyName || "—";
    document.getElementById("website").textContent = data.companyWebsite || "—";
    document.getElementById("location").textContent = data.location || "—";
    document.getElementById("since").textContent = data.since ? "Since " + data.since : "—";
    document.getElementById("description").textContent = data.companyDescription || "—";
    document.getElementById("avatar").textContent = data.companyName?.charAt(0).toUpperCase() || "R";
  } catch (e) {
    console.error(e);
    alert("Unable to load profile");
  }
}

// Open Edit Profile Modal with existing values
document.getElementById("editProfileBtn").onclick = () => {
  // Prefill input fields
  document.getElementById("companyNameInput").value = recruiterProfile.companyName || "";
  document.getElementById("companyWebsiteInput").value = recruiterProfile.companyWebsite || "";
  document.getElementById("locationInput").value = recruiterProfile.location || "";
  document.getElementById("sinceInput").value = recruiterProfile.since || "";
  document.getElementById("companyDescriptionInput").value = recruiterProfile.companyDescription || "";

  profileModal.classList.add("active");
};

document.getElementById("cancelEditProfile").onclick = () => profileModal.classList.remove("active");

// Save profile changes
document.getElementById("saveProfileBtn").onclick = async () => {
  const payload = {
    companyName: document.getElementById("companyNameInput").value,
    companyWebsite: document.getElementById("companyWebsiteInput").value,
    location: document.getElementById("locationInput").value,
    since: parseInt(document.getElementById("sinceInput").value),
    companyDescription: document.getElementById("companyDescriptionInput").value
  };

  try {
    const resp = await fetch(`${API_BASE}/recruiter/update/profile`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      credentials: "include",
      body: JSON.stringify(payload)
    });

    if (resp.ok) {
      alert("Profile updated successfully!");
      profileModal.classList.remove("active");
      loadProfile();
    } else {
      alert("Update failed");
    }
  } catch (err) {
    console.error(err);
    alert("Error updating profile");
  }
};

// Account Modal
document.getElementById("editAccountBtn").onclick = () => accountModal.classList.add("active");            //------------------------------------------//
document.getElementById("cancelEditAccount").onclick = () => accountModal.classList.remove("active");

document.getElementById("saveAccountBtn").onclick = async () => {
  const payload = {
    username: document.getElementById("usernameInput").value,
    email: document.getElementById("emailInput").value,
    password: document.getElementById("passwordInput").value
  };

  try {
    const resp = await fetch(`${API_BASE}/front/update/username/password`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      credentials: "include",
      body: JSON.stringify(payload)
    });

    if (resp.ok) {
      alert("Account info updated successfully!");
      accountModal.classList.remove("active");
    } else {
      alert("Failed to update account info");
    }
  } catch (err) {
    console.error(err);
    alert("Error updating account info");
  }
};

loadProfile();
</script>
</body>
</html>
